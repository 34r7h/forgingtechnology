"use strict";angular.module("numetal",["ngAnimate","ngAria","ngResource","ngSanitize","ngTouch","ui.router","ngFabForm","firebase","ngMeta"]),angular.module("numetal").run(["ngMeta",function(e){e.init()}]),angular.module("numetal").directive("admin",function(){return{templateUrl:"scripts/admin/admin-d.html",restrict:"EA"}}),angular.module("numetal").directive("connect",function(){return{templateUrl:"scripts/connect/connect-d.html",restrict:"EA"}}),angular.module("numetal").directive("content",["State",function(e){return{templateUrl:"scripts/content/content-d.html",restrict:"EA",controller:["$scope","$attrs",function(t,n){e.type=n.type}]}}]),angular.module("numetal").directive("contentSingle",["$state",function(e){return{templateUrl:"scripts/content-single/content-single-d.html",restrict:"EA",controller:["$scope","$attrs",function(t,n){t.$parent.metal.s.type=n.type,t.$parent.metal.s.params=e.params[t.$parent.metal.s.type]}]}}]),angular.module("numetal").directive("layout",function(){return{templateUrl:"scripts/layout/layout-d.html",restrict:"EA"}});var AWS=AWS,Firebase=Firebase;angular.module("numetal").factory("Api",["$http","$state","Data","$firebaseObject","$firebaseAuth","$firebaseArray","$timeout","State","$rootScope","$anchorScroll","$location",function(e,t,n,a,o,s,i,r,c,l,u){var d={anchor:function(e){u.hash(e),l()},reset:function(e){var t=o(n.refs.fb);t.$resetPassword({email:"bryce"===e.toLowerCase()?"masukmetaldesign+forgingtechnology@gmail.com":e}).then(function(){r.resetConfirmation=!0,i(function(){r.resetConfirmation=!1},5e3),console.log("Password reset email sent successfully!")})["catch"](function(e){console.error("Error: ",e)})},email:function(e,t,a){var i=new Firebase("https://sizzling-fire-2548.firebaseio.com/messages");s(i).$loaded().then(function(s){s.$add({subject:e,text:t,from:a}).then(function(e){console.log(e);var t=o(n.refs.fb);t.$resetPassword({email:"masukmetaldesign+forgingtechnology@gmail.com"}).then(function(){console.log("Password reset email sent successfully!")})["catch"](function(e){console.error("Error: ",e)})})})},login:function(e,t){var a=o(n.refs.fb);a.$authWithPassword({email:"bryce"===e.toLowerCase()?"masukmetaldesign@gmail.com":e,password:t}).then(function(e){console.log("Logged in as:",e.uid),r.auth=e})["catch"](function(e){console.error("Authentication failed:",e)})},logout:function(){var e=new Firebase("https://sizzling-fire-2548.firebaseio.com");r.auth=o(e),r.auth.$unauth(),r.auth=null},log:function(e,t){return c.debug?"object"==typeof e?angular.forEach(e,function(e,n){console.log("%c"+n+": "+e,"background:#aaaaaa; color:#fefefe, padding:10px",t)}):console.log("%c"+e,"background:#aaaaaa; color:#fefefe, padding:10px",t):null},copy:function(e){return angular.copy(e)},get:function(t){var n={};return e.get(t).then(function(e){n.data=e}),n},go:function(e,n){t.go(e,n),t.reload(e)},add:function(e,t){function a(){t.updated=Date.now(),t.publish=t.publish?t.publish:!0,n.object[e]?null:n.object[e]={},n.array[e].$add(t).then(function(a){function o(){angular.forEach(t.tags,function(e){-1===s.indexOf(e)?s.push(e):null,n.object.index.tags?null:n.object.index.tags={},n.object.index.tags[e]?n.object.index.tags[e][a.key()]=!0:(n.object.index.tags[e]={},n.object.index.tags[e][a.key()]=!0)}),t.tags=s}n.object.index?null:n.object.index={},n.object.posts?null:n.object.posts={},n.object.index[e]?null:n.object.index[e]={},t.section?n.object.index.sections?null:n.object.index.sections={}:null,t.section?n.object.index.sections[t.section]?n.object.index.sections[t.section][a.key()]=!0:(n.object.index.sections[t.section]={},n.object.index.sections[t.section][a.key()]=!0):null,n.object.index[e][a.key()]=!0;var s=["metal"];t.tags=t.tags?o():s,n.object.posts[a.key()]=e,n.object.$save()})}function o(){console.error("New entries must have a name")}t.name?a():o()},rm:function(e,t){function o(){var o={bucket:"forgingtechnologies.com",accessKey:d.get("https://sizzling-fire-2548.firebaseio.com/keys/access.json"),secretKey:d.get("https://sizzling-fire-2548.firebaseio.com/keys/secret.json")},s={Bucket:o.bucket,Key:n.object[e][t].name};n.media=a(n.refs.media).$loaded().then(function(a){n.object.media[t].tags?angular.forEach(n.object.media[t].tags,function(e){n.object.index.tags[e][t]=null}):null,a[n.object[e][t].name.replace(".","`")]=null,n.object[e][t]=null,n.object.posts[t]=null,n.object.index.media[t]=null,n.object.$save(),a.$save(),i(function(){AWS.config.update({accessKeyId:o.accessKey.data.data,secretAccessKey:o.secretKey.data.data}),AWS.config.region="us-west-2";var e=new AWS.S3;e.deleteObject(s,function(e,t){t||console.log("Check if you have sufficient permissions : "+e)})},2e3)})}function s(){angular.forEach(n.object.content[t].tags,function(e){n.object.index.tags[e][t]=null}),n.object.index.sections[n.object.content[t].section][t]=null,n.object[e][t]=null,n.object.index[e][t]=null,n.object.posts[t]=null,n.object.$save()}"media"===e?o():null,"media"!==e?s():null},saveSite:function(e){var t=a(n.refs.fb.child("site"));angular.forEach(e,function(e,n){t[n]=e}),t.$save().then(function(e){e.key()===t.$id},function(e){console.log("Error:",e)})},save:function(e,t,o,s){function r(){a(n.refs.fb.child(e)).$loaded().then(function(e){e[t]=o,e.$save().then(function(){return e[t]},function(e){console.log("Error:",e)})})}function c(){d.tags&&d.sections?r():i(function(){c()},1e3)}function l(){return o.section!==s.section?(n.object.index.sections[s.section][t]=null,n.object.index.sections[o.section][t]=!0):null,d.sections=!0}function u(){console.log("checking tags",s.tags,o.tags);var e=[];return angular.forEach(o.tags,function(a){n.object.index.tags?null:n.object.index.tags={},-1===e.indexOf(a)?e.push(a):null,n.object.index.tags[a]?null:n.object.index.tags[a]={},n.object.index.tags[a][t]=!0}),angular.forEach(e,function(e){angular.forEach(s.tags,function(a){console.log(e,a),o.tags.indexOf(a)<0?n.object.index.tags[a][t]=null:null})}),o.tags=e,n.object.$save(),d.tags=!0}var d={};return o?null:o=n.object[e][t],s?null:s=o,JSON.stringify(s.tags)!==JSON.stringify(o.tags)?u():d.tags=!0,JSON.stringify(s.section)!==JSON.stringify(o.section)?l():d.sections=!0,c(),o},msg:function(e){var t=performance.now();console.log(performance.now()-t,e)}};return d}]);var Firebase=Firebase;angular.module("numetal").factory("Data",["$firebaseObject","$firebaseArray","$firebaseAuth","State",function(e,t,n,a){var o="https://sizzling-fire-2548.firebaseio.com/data",s="https://sizzling-fire-2548.firebaseio.com/media",i=new Firebase(o),r=new Firebase("https://sizzling-fire-2548.firebaseio.com"),c=n(r);a.auth=c.$getAuth();for(var l=new Firebase(o).child("content"),u=new Firebase(s),d=e(i),m=["content","site","media","posts","index"],g={},f=m.length-1;f>=0;f--)g[m[f]]=t(i.child(m[f]));var p={index:{},object:{},array:[],refs:{media:u,fb:i,content:l}};return d.$loaded().then(function(e){p.object=e,p.array=g}),p}]),angular.module("numetal").factory("Facts",["Api","Data","State","Ux",function(e,t,n,a){for(;!(e&&t&&n&&a);)console.log("Awaiting DI");var o={api:e,data:t,state:n,ux:a};return o}]),angular.module("numetal").factory("State",["$state",function(e){var t={state:e,params:e.params,current:e.current,data:{},show:{}};return t}]),angular.module("numetal").factory("Ux",["$window","$rootScope",function(e,t){function n(){a.xy=[e.innerWidth,e.innerHeight]}var a={xy:[e.innerWidth,e.innerHeight],share:[{name:"facebook",color:"#3b5998"},{name:"google",color:"#f15b44"},{name:"twitter",color:"#00aced"},{name:"pinterest",color:"#c92228"},{name:"instagram",color:"#833ab4"}]};return angular.element(e).bind("resize",function(){n(),t.$apply(a.xy)}),a}]),angular.module("numetal").directive("posts",function(){return{templateUrl:"scripts/posts/posts-d.html",restrict:"EA"}}),angular.module("numetal").directive("postsSingle",function(){return{templateUrl:"scripts/posts-single/posts-single-d.html",restrict:"EA"}}),angular.module("numetal").config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,t,n){n.html5Mode(!0),n.hashPrefix("!"),t.otherwise("/"),e.state("metal",{url:"",title:"Forging Technology",template:"<layout></layout>","abstract":!0,controller:["Facts",function(e){var t=this;t.a=e.api,t.d=e.data,t.s=e.state,t.u=e.ux}],controllerAs:"metal"}).state("metal.home",{url:"/",template:"<posts></posts>"}).state("metal.about",{url:"/about",template:'<content section="about" type="about"></content>'}).state("metal.about.about",{url:"/:about",template:'<content-single type="about" section="about"></content-single>'}).state("metal.services",{url:"/services",template:'<content type="services" section="services"></content>'}).state("metal.services.services",{url:"/:services",template:'<content-single type="services" section="services"></content-single>'}).state("metal.clients",{url:"/clients",template:'<content type="clients" section="clients"></content>'}).state("metal.clients.clients",{url:"/:clients",template:'<content-single type="clients" section="clients"></content-single>'}).state("metal.posts",{url:"/posts",template:'<content section="posts" type="posts"></content>'}).state("metal.posts.posts",{url:"/:posts",template:'<content-single section="posts" type="posts"></content-single>'}).state("metal.gallery",{url:"/gallery",template:'<content section="gallery" type="gallery"></content>'}).state("metal.gallery.gallery",{url:"/:gallery",template:'<content-single section="gallery" type="gallery"></content-single>'}).state("metal.admin",{url:"/admin",template:"<admin></admin>"}).state("metal.admin.add",{url:"/add",templateUrl:"scripts/admin/add-entry.html"}).state("metal.admin.site",{url:"/site",templateUrl:"scripts/admin/edit-site.html"}).state("metal.admin.services",{url:"/services",templateUrl:"scripts/admin/edit-entries.html",controller:["State",function(e){e.type="services"}]}).state("metal.admin.clients",{url:"/clients",templateUrl:"scripts/admin/edit-entries.html",controller:["State",function(e){e.type="clients"}]}).state("metal.admin.media",{url:"/media",templateUrl:"scripts/admin/edit-media.html",controller:["State",function(e){e.type="media"}]}).state("metal.admin.messages",{url:"/messages",templateUrl:"scripts/admin/edit-messages.html"}).state("metal.admin.posts",{url:"/posts",templateUrl:"scripts/admin/edit-posts.html"})}]);var AWS=AWS;angular.module("numetal").directive("uploader",["Api",function(e){return{restrict:"AE",templateUrl:"scripts/uploader/uploader-d.html",scope:{file:"@"},controller:["$scope","$firebaseObject","Data","$timeout",function(t,n,a,o){t.uploadS3=function(){var s;console.info("Begin Uploading to S3",s=performance.now()),AWS.config.update({accessKeyId:t.creds.accessKey.data.data,secretAccessKey:t.creds.secretKey.data.data}),AWS.config.region="us-west-2";var i=new AWS.S3({params:{Bucket:t.creds.bucket}}),r=Date.now(),c=[],l=n(a.refs.media);if(t.files.length)for(var u=[],d=[],m=[],g=t.files.length-1;g>=0;g--){d[g]=r+"-"+t.files[g].name,u[g]=t.files[g].type;var f={Key:d[g],ContentType:u[g],Body:t.files[g],ServerSideEncryption:"AES256"};i.putObject(f,function(e,n){return e?(console.error(e.message,e.code),!1):(setTimeout(function(){t.uploadProgress=0,t.$digest()},4e3),n)}).on("httpUploadProgress",function(e){t.uploadProgress=Math.round(e.loaded/e.total*100),t.$digest()}),m[g]=new FileReader,m[g].onload=function(e,t){return m[t].readAsDataURL(e),function(e){!function(n){var a=document.createElement("canvas"),s=a.getContext("2d"),i=n,r=new Image;r.src=i;var u=160,m=r.width/u;return a.width=u,a.height=r.height/m,s.drawImage(r,0,0,a.width,a.height),c[t]=a.toDataURL("image/jpeg",.75),l.$loaded().then(function(e){e[d[t].replace(".","`")]=c[t],o(e.$save(),5e3)}),e.target.result}(e.target.result)}}(t.files[g],g),e.add("media",{src:"https://s3-us-west-2.amazonaws.com/forgingtechnologies.com/"+d[g],type:u[g],name:d[g]})}else console.error("Please select a file to upload");console.info("End Upload to S3",performance.now()-s)}}],link:function(t,n){t.creds={bucket:"forgingtechnologies.com",accessKey:e.get("https://sizzling-fire-2548.firebaseio.com/keys/access.json"),secretKey:e.get("https://sizzling-fire-2548.firebaseio.com/keys/secret.json")},n.bind("change",function(e){var n=e.target.files,a=n[0];t.files=n,t.file=a,t.$parent.file=a,t.$apply()})}}}]);