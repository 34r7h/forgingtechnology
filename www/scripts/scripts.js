"use strict";angular.module("numetal",["ngAnimate","ngAria","ngResource","ngSanitize","ngTouch","ui.router","ngFabForm","firebase","ngMeta"]),angular.module("numetal").run(["ngMeta",function(e){e.init()}]),angular.module("numetal").directive("admin",function(){return{templateUrl:"scripts/admin/admin-d.html",restrict:"EA",controller:["$scope","$attrs",function(e,t){e.$parent.admin.s.type=t.type,e.$parent.admin.s.section=t.section}]}}),angular.module("numetal").directive("connect",function(){return{templateUrl:"scripts/connect/connect-d.html",restrict:"EA"}}),angular.module("numetal").directive("content",["State",function(e){return{templateUrl:"scripts/content/content-d.html",restrict:"EA",controller:["$scope","$attrs",function(t,n){e.type=n.type}]}}]),angular.module("numetal").directive("contentSingle",["$state",function(e){return{templateUrl:"scripts/content-single/content-single-d.html",restrict:"EA",controller:["$scope","$attrs",function(t,n){t.$parent.metal.s.type=n.type,t.$parent.metal.s.params=e.params[t.$parent.metal.s.type]}]}}]),angular.module("numetal").directive("layout",function(){return{templateUrl:"scripts/layout/layout-d.html",restrict:"EA"}});var AWS=AWS,Firebase=Firebase;angular.module("numetal").factory("Api",["$http","$state","Data","$firebaseObject","$firebaseAuth","$firebaseArray","$timeout","State","$rootScope","$anchorScroll","$location",function(e,t,n,a,o,i,s,r,c,l,u){var g={anchor:function(e){u.hash(e),l()},email:function(e,t,a){var s=new Firebase("https://sizzling-fire-2548.firebaseio.com/messages");i(s).$loaded().then(function(i){i.$add({subject:e,text:t,from:a}).then(function(e){console.log(e);var t=o(n.refs.fb);t.$resetPassword({email:"masukmetaldesign+forgingtechnology@gmail.com"}).then(function(){console.log("Password reset email sent successfully!")})["catch"](function(e){console.error("Error: ",e)})})})},login:function(e,t){var a=o(n.refs.fb);a.$authWithPassword({email:"bryce"===e.toLowerCase()?"masukmetaldesign@gmail.com":e,password:t}).then(function(e){console.log("Logged in as:",e.uid),r.auth=e})["catch"](function(e){console.error("Authentication failed:",e)})},logout:function(){var e=new Firebase("https://sizzling-fire-2548.firebaseio.com");r.auth=o(e),r.auth.$unauth(),r.auth=null},log:function(e,t){return c.debug?"object"==typeof e?angular.forEach(e,function(e,n){console.log("%c"+n+": "+e,"background:#aaaaaa; color:#fefefe, padding:10px",t)}):console.log("%c"+e,"background:#aaaaaa; color:#fefefe, padding:10px",t):null},copy:function(e){return angular.copy(e)},get:function(t){var n={};return e.get(t).then(function(e){n.data=e}),n},go:function(e,n){t.go(e,n),t.reload(e)},add:function(e,t){function a(){t.updated=Date.now(),t.publish=t.publish?t.publish:!0,n.object[e]?null:n.object[e]={},n.array[e].$add(t).then(function(a){function o(){angular.forEach(t.tags,function(e){-1===i.indexOf(e)?i.push(e):null,n.object.index.tags?null:n.object.index.tags={},n.object.index.tags[e]?n.object.index.tags[e][a.key()]=!0:(n.object.index.tags[e]={},n.object.index.tags[e][a.key()]=!0)}),t.tags=i}n.object.index?null:n.object.index={},n.object.posts?null:n.object.posts={},n.object.index[e]?null:n.object.index[e]={},t.section?n.object.index.sections?null:n.object.index.sections={}:null,t.section?n.object.index.sections[t.section]?n.object.index.sections[t.section][a.key()]=!0:(n.object.index.sections[t.section]={},n.object.index.sections[t.section][a.key()]=!0):null,n.object.index[e][a.key()]=!0;var i=["metal"];t.tags=t.tags?o():i,n.object.posts[a.key()]=e,n.object.$save()})}function o(){console.error("New entries must have a name")}t.name?a():o()},rm:function(e,t){function o(){var o={bucket:"forgingtechnologies.com",accessKey:"AKIAIYGVTJVFY77MNYCQ",secretKey:"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"};AWS.config.update({accessKeyId:o.accessKey,secretAccessKey:o.secretKey}),AWS.config.region="us-west-2";var i=new AWS.S3,s={Bucket:o.bucket,Key:n.object[e][t].name};i.deleteObject(s,function(e,t){t||console.log("Check if you have sufficient permissions : "+e)}),n.media=a(n.refs.media).$loaded().then(function(a){n.object.media[t].tags?angular.forEach(n.object.media[t].tags,function(e){n.object.index.tags[e][t]=null}):null,a[n.object[e][t].name.replace(".","`")]=null,n.object[e][t]=null,n.object.posts[t]=null,n.object.index.media[t]=null,n.object.$save(),a.$save()})}function i(){angular.forEach(n.object.content[t].tags,function(e){n.object.index.tags[e][t]=null}),n.object.index.sections[n.object.content[t].section][t]=null,n.object[e][t]=null,n.object.index[e][t]=null,n.object.posts[t]=null,n.object.$save()}"media"===e?o():null,"media"!==e?i():null},saveSite:function(e){var t=a(n.refs.fb.child("site"));angular.forEach(e,function(e,n){t[n]=e}),t.$save().then(function(e){e.key()===t.$id},function(e){console.log("Error:",e)})},save:function(e,t,o,i){function r(){a(n.refs.fb.child(e)).$loaded().then(function(e){e[t]=o,e.$save().then(function(){return e[t]},function(e){console.log("Error:",e)})})}function c(){g.tags&&g.sections?r():s(function(){c()},1e3)}function l(){return o.section!==i.section?(n.object.index.sections[i.section][t]=null,n.object.index.sections[o.section][t]=!0):null,g.sections=!0}function u(){console.log("checking tags",i.tags,o.tags);var e=[];return angular.forEach(o.tags,function(a){n.object.index.tags?null:n.object.index.tags={},-1===e.indexOf(a)?e.push(a):null,n.object.index.tags[a]?null:n.object.index.tags[a]={},n.object.index.tags[a][t]=!0}),angular.forEach(e,function(e){angular.forEach(i.tags,function(a){console.log(e,a),o.tags.indexOf(a)<0?n.object.index.tags[a][t]=null:null})}),o.tags=e,n.object.$save(),g.tags=!0}var g={};return o?null:o=n.object[e][t],i?null:i=o,JSON.stringify(i.tags)!==JSON.stringify(o.tags)?u():g.tags=!0,JSON.stringify(i.section)!==JSON.stringify(o.section)?l():g.sections=!0,c(),o},msg:function(e){var t=performance.now();console.log(performance.now()-t,e)}};return g}]);var Firebase=Firebase;angular.module("numetal").factory("Data",["$firebaseObject","$firebaseArray","$firebaseAuth","State",function(e,t,n,a){var o="https://sizzling-fire-2548.firebaseio.com/data",i="https://sizzling-fire-2548.firebaseio.com/media",s=new Firebase(o),r=new Firebase("https://sizzling-fire-2548.firebaseio.com"),c=n(r);a.auth=c.$getAuth();for(var l=new Firebase(o).child("content"),u=new Firebase(i),g=e(s),m=["content","site","media","posts","index"],d={},f=m.length-1;f>=0;f--)d[m[f]]=t(s.child(m[f]));var p={index:{},object:{},array:[],refs:{media:u,fb:s,content:l}};return g.$loaded().then(function(e){p.object=e,p.array=d}),p}]),angular.module("numetal").factory("Facts",["Api","Data","State","Ux",function(e,t,n,a){for(;!(e&&t&&n&&a);)console.log("Awaiting DI");var o={api:e,data:t,state:n,ux:a};return o}]),angular.module("numetal").factory("State",["$state",function(e){var t={state:e,params:e.params,current:e.current,data:{},show:{}};return t}]),angular.module("numetal").factory("Ux",["$window","$rootScope",function(e,t){function n(){a.xy=[e.innerWidth,e.innerHeight]}var a={xy:[e.innerWidth,e.innerHeight],share:[{name:"facebook",color:"#3b5998"},{name:"google",color:"#f15b44"},{name:"twitter",color:"#00aced"},{name:"pinterest",color:"#c92228"},{name:"instagram",color:"#833ab4"}]};return angular.element(e).bind("resize",function(){n(),t.$apply(a.xy)}),a}]),angular.module("numetal").directive("posts",function(){return{templateUrl:"scripts/posts/posts-d.html",restrict:"EA"}}),angular.module("numetal").directive("postsSingle",function(){return{templateUrl:"scripts/posts-single/posts-single-d.html",restrict:"EA"}}),angular.module("numetal").config(["$stateProvider","$urlRouterProvider","$locationProvider","ngMetaProvider",function(e,t,n,a){function o(e){var t=", ";return angular.forEach(e,function(e){t=t+e+", "}),t+"Vancouver, BC"}n.html5Mode(!0),n.hashPrefix("!"),t.otherwise("/"),e.state("metal",{url:"",title:"Forging Technology",template:"<layout></layout>","abstract":!0,controller:["Facts",function(e){var t=this;t.a=e.api,t.d=e.data,t.s=e.state,t.u=e.ux}],controllerAs:"metal"}).state("metal.home",{url:"/",template:"<posts></posts>",meta:{title:"Forging Technology Posts",description:"Forging Technology is a metalwork company serving the greater Vancouver BC area.",tags:o(["posts","metal work","driveway gates","railings","spiral staircase","forge","iron","steel","home automation"])}}).state("metal.about",{url:"/about",template:'<content section="about" type="about"></content>',meta:{title:"Forging Technology - About",description:"Forging Technology is a metalwork company serving the greater Vancouver BC area.",tags:o(["about","driveway gates","railings","spiral staircase","forge","iron","steel","home automation","Vancouver","BC"])}}).state("metal.about.about",{url:"/:about",template:'<content-single type="about" section="about"></content-single>',meta:{title:"Forging Technology About",description:"Forging Technology is a metalwork company serving the greater Vancouver BC area.",tags:o(["about","driveway gates","railings","spiral staircase","forge","iron","steel","home automation","Vancouver","BC"])}}).state("metal.services",{url:"/services",template:'<content type="services" section="services"></content>',meta:{title:"Forging Technology Services",description:"Forging Technology is a metalwork company creating unique, beautiful driveway gates, ",tags:o(["services","driveway gates","railings","spiral staircase","home automation"])}}).state("metal.services.services",{url:"/:services",template:'<content-single type="services" section="services"></content-single>',meta:{title:"Forging Technology Services",description:"Forging Technology is a metalwork company creating unique, beautiful driveway gates, railings, and custom metal products",tags:o(["services","driveway gates","railings","spiral staircase","home automation"])}}).state("metal.clients",{url:"/clients",template:'<content type="clients" section="clients"></content>',meta:{title:"Forging Technology Clients",description:"Forging Technology is a metalwork company creating unique, beautiful driveway gates, ",tags:o(["driveway gates","railings","spiral staircase","home automation"])}}).state("metal.clients.clients",{url:"/:clients",template:'<content-single type="clients" section="clients"></content-single>',meta:{title:"Forging Technology Clients",description:"Forging Technology is a metalwork company creating unique, beautiful driveway gates, ",tags:o(["driveway gates","railings","spiral staircase","home automation"])}}).state("metal.posts",{url:"/posts",template:'<content section="posts" type="posts"></content>',meta:{title:"Forging Technology Clients",description:"Forging Technology is a metalwork company creating unique, beautiful driveway gates, ",tags:o(["driveway gates","railings","spiral staircase","home automation"])}}).state("metal.posts.posts",{url:"/:posts",template:'<content-single section="posts" type="posts"></content-single>'}).state("metal.gallery",{url:"/gallery",template:'<content section="gallery" type="gallery"></content>'}).state("metal.gallery.gallery",{url:"/:gallery",template:'<content-single section="gallery" type="gallery"></content-single>'}).state("admin",{url:"/admin",template:"<admin></admin>",controller:["Facts",function(e){var t=this;t.a=e.api,t.d=e.data,t.s=e.state,t.u=e.ux}],controllerAs:"admin"}).state("admin.site",{url:"/site",template:'<admin type="site"></admin>',onEnter:["State",function(e){e.show.editSite=!0}],onExit:["State",function(e){e.show.editSite=!1}]}).state("admin.services",{url:"/services",template:'<admin type="services"></admin>'}).state("admin.clients",{url:"/clients",template:'<admin type="clients"></admin>'}).state("admin.media",{url:"/media",template:'<admin type="media"></admin>',onEnter:["State",function(e){e.show.showMedia=!0}],onExit:["State",function(e){e.show.showMedia=!1}]}).state("admin.messages",{url:"/messages",template:"<admin></admin>",onEnter:["State",function(e){e.show.messages=!0}],onExit:["State",function(e){e.show.messages=!1}]}).state("admin.posts",{url:"/posts",template:'<admin type="posts"></admin>',onEnter:["State",function(e){e.show.editPosts=!0}],onExit:["State",function(e){e.show.editPosts=!1}]})}]);var AWS=AWS;angular.module("numetal").directive("uploader",function(){return{restrict:"AE",templateUrl:"scripts/uploader/uploader-d.html",scope:{file:"@"},controller:["$scope","Api","$firebaseObject","Data","$timeout",function(e,t,n,a,o){e.uploadS3=function(){var i;console.info("Begin Uploading to S3",i=performance.now()),AWS.config.update({accessKeyId:e.creds.accessKey,secretAccessKey:e.creds.secretKey}),AWS.config.region="us-west-2";var s=new AWS.S3({params:{Bucket:e.creds.bucket}}),r=Date.now(),c=[],l=n(a.refs.media);if(e.files.length)for(var u=[],g=[],m=[],d=e.files.length-1;d>=0;d--){g[d]=r+"-"+e.files[d].name,u[d]=e.files[d].type;var f={Key:g[d],ContentType:u[d],Body:e.files[d],ServerSideEncryption:"AES256"};s.putObject(f,function(t,n){return t?(console.error(t.message,t.code),!1):(setTimeout(function(){e.uploadProgress=0,e.$digest()},4e3),n)}).on("httpUploadProgress",function(t){e.uploadProgress=Math.round(t.loaded/t.total*100),e.$digest()}),m[d]=new FileReader,m[d].onload=function(e,t){return m[t].readAsDataURL(e),function(e){!function(n){var a=document.createElement("canvas"),i=a.getContext("2d"),s=n,r=new Image;r.src=s;var u=160,m=r.width/u;return a.width=u,a.height=r.height/m,i.drawImage(r,0,0,a.width,a.height),c[t]=a.toDataURL("image/jpeg",.75),l.$loaded().then(function(e){e[g[t].replace(".","`")]=c[t],o(e.$save(),5e3)}),e.target.result}(e.target.result)}}(e.files[d],d),t.add("media",{src:"https://s3-us-west-2.amazonaws.com/forgingtechnologies.com/"+g[d],type:u[d],name:g[d]})}else console.error("Please select a file to upload");console.info("End Upload to S3",performance.now()-i)}}],link:function(e,t){e.creds={bucket:"forgingtechnologies.com",accessKey:"AKIAIYGVTJVFY77MNYCQ",secretKey:"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"},t.bind("change",function(t){var n=t.target.files,a=n[0];e.files=n,e.file=a,e.$parent.file=a,e.$apply()})}}});